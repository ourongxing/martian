import{unified as M}from"unified";import S from"remark-parse";var b={abap:"abap",sh:"shell","shell-script":"shell",bash:"shell",zsh:"shell",text:"vb.net",c_cpp:"c++",clojure:"clojure",coffee:"coffeescript","coffee-script":"coffeescript",cpp:"c++",csharp:"c#",cake:"c#",cakescript:"c#",css:"css",dart:"dart",diff:"diff",udiff:"diff",dockerfile:"docker",elixir:"elixir",elm:"elm",erlang:"erlang",fsharp:"f#",cucumber:"gherkin",glsl:"glsl",golang:"go",groovy:"groovy",haskell:"haskell",html:"html",xhtml:"html",java:"java/c/c++/c#",javascript:"javascript",js:"javascript",node:"javascript",json:"json",julia:"julia",tex:"latex",latex:"latex",less:"less",lisp:"webassembly",livescript:"livescript","live-script":"livescript",ls:"livescript",lua:"lua",makefile:"makefile",bsdmake:"makefile",make:"makefile",mf:"makefile",markdown:"markdown",pandoc:"markdown",matlab:"matlab",octave:"matlab",nix:"nix",nixos:"nix",objectivec:"objective-c","obj-c":"objective-c",objc:"objective-c",ocaml:"ocaml",pascal:"pascal",delphi:"pascal",objectpascal:"pascal",perl:"perl",cperl:"perl",php:"php",inc:"php",powershell:"powershell",posh:"powershell",pwsh:"powershell",prolog:"prolog",protobuf:"protobuf","Protocol Buffers":"protobuf",python:"python",python3:"python",rusthon:"python",r:"r",R:"r",Rscript:"r",splus:"r",rust:"rust",ruby:"ruby",jruby:"ruby",macruby:"ruby",rake:"ruby",rb:"ruby",rbx:"ruby",rs:"rust",sass:"sass",scala:"scala",scheme:"scheme",scss:"scss",sql:"sql",typescript:"typescript",ts:"typescript","visual basic":"vb.net",vbnet:"vb.net","vb .net":"vb.net","vb.net":"vb.net",verilog:"verilog",vhdl:"vhdl",wast:"webassembly",wasm:"webassembly",xml:"xml",rss:"xml",xsd:"xml",wsdl:"xml",yaml:"yaml",yml:"yaml"};var l={PAYLOAD_BLOCKS:1e3,RICH_TEXT_ARRAYS:100,RICH_TEXT:{TEXT_CONTENT:2e3,LINK_URL:1e3,EQUATION_EXPRESSION:1e3}};function X(e){return!e||e===""?!1:/^https?:\/\/.+/i.test(e)}function u(e,t={}){let r={bold:!1,strikethrough:!1,underline:!1,italic:!1,code:!1,color:"default",...t.annotations||{}};return t.type==="equation"?{type:"equation",annotations:r,equation:{expression:e}}:{type:"text",annotations:r,text:{content:e,link:X(t.url)?{type:"url",url:t.url}:void 0}}}var H=["abap","arduino","bash","basic","c","clojure","coffeescript","c++","c#","css","dart","diff","docker","elixir","elm","erlang","flow","fortran","f#","gherkin","glsl","go","graphql","groovy","haskell","html","java","javascript","json","julia","kotlin","latex","less","lisp","livescript","lua","makefile","markdown","markup","matlab","mermaid","nix","objective-c","ocaml","pascal","perl","php","plain text","powershell","prolog","protobuf","python","r","reason","ruby","rust","sass","scala","scheme","scss","shell","sql","swift","typescript","vb.net","verilog","vhdl","visual basic","webassembly","xml","yaml","java/c/c++/c#"];function g(e){return H.includes(e)}function k(){return{object:"block",type:"divider",divider:{}}}function f(e){return{object:"block",type:"paragraph",paragraph:{rich_text:e}}}function T(e,t="plain text"){return{object:"block",type:"code",code:{rich_text:e,language:t}}}function y(e=[],t=[]){return{object:"block",type:"quote",quote:{rich_text:e.length?e:[u("")],children:t}}}function m(e){return{object:"block",type:"image",image:{type:"external",external:{url:e}}}}function R(){return{object:"block",type:"table_of_contents",table_of_contents:{}}}function _(e){return{object:"block",type:"heading_1",heading_1:{rich_text:e}}}function B(e){return{object:"block",type:"heading_2",heading_2:{rich_text:e}}}function C(e){return{object:"block",type:"heading_3",heading_3:{rich_text:e}}}function w(e,t=[]){return{object:"block",type:"bulleted_list_item",bulleted_list_item:{rich_text:e,children:t.length?t:void 0}}}function v(e,t=[]){return{object:"block",type:"numbered_list_item",numbered_list_item:{rich_text:e,children:t.length?t:void 0}}}function L(e,t,r=[]){return{object:"block",type:"to_do",to_do:{rich_text:t,checked:e,children:r.length?r:void 0}}}function j(e,t){return{object:"block",type:"table",table:{table_width:t,has_column_header:!0,children:e!=null&&e.length?e:[]}}}function O(e=[]){return{object:"block",type:"table_row",table_row:{cells:e.length?e:[]}}}function E(e){return{type:"equation",equation:{expression:e}}}function I(e){return e?b[e.toLowerCase()]:void 0}import D from"path";import{URL as K}from"url";function A(e,t){return(e.match(/[^]{1,2000}/g)||[]).flatMap(o=>u(o,t))}function Y(e){if(e)return e=e.toLowerCase(),g(e)?e:I(e)}function s(e,t){var o;let r={annotations:{...(o=t==null?void 0:t.annotations)!=null?o:{}},url:t==null?void 0:t.url};switch(e.type){case"text":return A(e.value,r);case"delete":return r.annotations.strikethrough=!0,e.children.flatMap(n=>s(n,r));case"emphasis":return r.annotations.italic=!0,e.children.flatMap(n=>s(n,r));case"strong":return r.annotations.bold=!0,e.children.flatMap(n=>s(n,r));case"link":return r.url=e.url,e.children.flatMap(n=>s(n,r));case"inlineCode":return r.annotations.code=!0,[u(e.value,r)];case"inlineMath":return[u(e.value,{...r,type:"equation"})];default:return[]}}function $(e,t){var n;let r=[".png",".jpg",".jpeg",".gif",".tif",".tiff",".bmp",".svg",".heic",".webp"];function o(){return f([u(e.url)])}try{if((n=t.strictImageUrls)==null||n){let i=new K(e.url),a=D.extname(i.pathname);return r.includes(a)?m(e.url):o()}else return m(e.url)}catch(i){return o()}}function G(e,t){if(e.children.length>2&&e.children[0].type==="text"&&e.children[0].value==="[["&&e.children[1].type==="emphasis"&&e.children[1].children[0].value==="TOC")return[R()];let o=[],n=[];return e.children.forEach(i=>{if(i.type==="image")o.push($(i,t));else{let a=s(i);a.length&&n.push(a)}}),n.length?[f(n.flat()),...o]:o}function z(e,t){let r=e.children.flatMap(o=>x(o,t));return y([],r)}function F(e){let t=e.children.flatMap(r=>s(r));switch(e.depth){case 1:return _(t);case 2:return B(t);default:return C(t)}}function J(e){let t=A(e.value),r=Y(e.lang);return T(t,r)}function Q(e,t){return e.children.flatMap(r=>{let o=r.children.shift();if(o===void 0||o.type!=="paragraph")return[];let n=o.children.flatMap(a=>s(a)),i=r.children.flatMap(a=>x(a,t));return e.start!==null&&e.start!==void 0?[v(n,i)]:r.checked!==null&&r.checked!==void 0?[L(r.checked,n,i)]:[w(n,i)]})}function V(e){return[e.children.flatMap(t=>s(t))]}function Z(e){let t=e.children.flatMap(r=>V(r));return[O(t)]}function ee(e){var o;let t=(o=e.children)!=null&&o.length?e.children[0].children.length:0,r=e.children.flatMap(n=>Z(n));return[j(r,t)]}function te(e){let t=e.value.split(`
`).join(`\\\\
`);return E(t)}function x(e,t){switch(e.type){case"heading":return[F(e)];case"paragraph":return G(e,t);case"code":return[J(e)];case"blockquote":return[z(e,t)];case"list":return Q(e,t);case"table":return ee(e);case"math":return[te(e)];case"thematicBreak":return[k()];default:return[]}}function N(e,t){var i,a,p,h;let r=e.children.flatMap(c=>x(c,t||{})),o=!!((a=(i=t==null?void 0:t.notionLimits)==null?void 0:i.truncate)==null||a),n=(h=(p=t==null?void 0:t.notionLimits)==null?void 0:p.onError)!=null?h:()=>{};return r.length>l.PAYLOAD_BLOCKS&&n(new Error(`Resulting blocks array exceeds Notion limit (${l.PAYLOAD_BLOCKS})`)),o?r.slice(0,l.PAYLOAD_BLOCKS):r}function q(e,t){var i,a,p,h;let r=[];e.children.forEach(c=>{if(c.type==="paragraph")c.children.forEach(d=>r.push(...s(d)));else if((t==null?void 0:t.nonInline)==="throw")throw new Error(`Unsupported markdown element: ${JSON.stringify(c)}`)});let o=!!((a=(i=t==null?void 0:t.notionLimits)==null?void 0:i.truncate)==null||a),n=(h=(p=t==null?void 0:t.notionLimits)==null?void 0:p.onError)!=null?h:()=>{};return r.length>l.RICH_TEXT_ARRAYS&&n(new Error(`Resulting richTexts array exceeds Notion limit (${l.RICH_TEXT_ARRAYS})`)),(o?r.slice(0,l.RICH_TEXT_ARRAYS):r).map(c=>{var d;return c.type!=="text"||(c.text.content.length>l.RICH_TEXT.TEXT_CONTENT&&(n(new Error(`Resulting text content exceeds Notion limit (${l.RICH_TEXT.TEXT_CONTENT})`)),o&&(c.text.content=c.text.content.slice(0,l.RICH_TEXT.TEXT_CONTENT-3)+"...")),(d=c.text.link)!=null&&d.url&&c.text.link.url.length>l.RICH_TEXT.LINK_URL&&n(new Error(`Resulting text URL exceeds Notion limit (${l.RICH_TEXT.LINK_URL})`))),c})}import P from"remark-gfm";import re from"remark-math";function Re(e,t){let r=M().use(S).use(P).use(re).parse(e);return N(r,t)}function _e(e,t){let r=M().use(S).use(P).parse(e);return q(r,t)}export{Re as markdownToBlocks,_e as markdownToRichText};
